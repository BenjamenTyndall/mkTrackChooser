<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" type="text/css" href="styles.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <title>Karts</title>
  <link rel="icon" href="img/favicon.png" type="image/png" />
</head>
<body class="body-bg">
<nav class="navbar sticky-top navbar-expand-lg glassy-squared">
  <div class="container-fluid">
    <a class="navbar-brand mkfont text-white padding-L title main-heading">KART</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item bold">
          <a class="nav-link active bold" aria-current="page" href="index.html">Home</a>
        </li>
        <li class="nav-item dropdown bold">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Categories
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="gp.html">Grand Prix</a></li>
            <li><a class="dropdown-item" href="ko.html">Knockout</a></li>
            <li><a class="dropdown-item" href="vs.html">VS</a></li>
            <li><a class="dropdown-item" href="characters.html">Characters</a></li>
            <li><a class="dropdown-item" href="kart.html">Kart</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="body-bg super-padding">
  <div>
    <h1 class="mkfont padding-top centre main-heading">KART<br />RANDOMISER</h1>
  </div>
  <div class="super-padding"><br /><br /><br /></div>

  <div class="d-flex justify-content-center align-items-center flex-column min-vh-500">
    <button class="mkfont btn-lg glassy large-btn text-white btntext glow-button" id="rolling-btn" onclick="pickRandomTrack()">ROLL</button>
    <h2 id="track-result" class="mt-3 title"></h2>
    <img id="track-image" src="" alt="Kart Image" class="mt-3" style="max-width: 400px; display: none;" />
  </div>
</div>

<footer class="footer super-margin text-center text-white py-4">
  <div class="container">
    <p class="mb-1">MarioKart World Track Chooser</p>
    <small>Not affiliated with Nintendo. This is just a little service to those wanting to spice up their MarioKart World gameplay. Feel free to add me on Discord @dr3kiki or instagram by the same name. ENJOY!</small>
  </div>
</footer>

<script>
  const tracks = [
    "Standard Kart",
    "Rally Kart",
    "Standard Bike",
    "Rally Bike",
    "Plushbuggy",
    "Baby Blooper",
    "Cute Scoot",
    "Mach Rocket",
    "Zoom Buggy",
    "Charginâ€™ Truck",
    "Funky Dorrie",
    "Hyper Pipe",
    "Hot Rod",
    "Ribbit Revster",
    "Tune Thumper",
    "Junkyard Hog",
    "Roadster Royale",
    "B Dasher",
    "W-Twin Chopper",
    "Lobster Roller",
    "Biddybuggy",
    "Tiny Titan",
    "Dread Sled",
    "Stellar Sled",
    "Reel Racer",
    "Bumble V",
    "Fin Twin",
    "R.O.B. H.O.G.",
    "Carpet Flyer",
    "Cloud 9",
    "Dolphin Dasher",
    "Blastronaut III",
    "Big Horn",
    "Liâ€™l Dumpy",
    "Loco Moto",
    "Mecha Trike",
    "Pipe Frame",
    "Billdozer",
    "Rallygator",
    "Bowser Bruiser",
  ];

  // Cache images to preload
  const imageCache = {};

  function getImagePath(trackName) {
    return (
      "img/" +
      trackName
        .toLowerCase()
        .replace(/[â€™']/g, "") // remove apostrophes
        .replace(/[^a-z0-9]+/g, "-") // replace non-alphanum with dashes
        .replace(/-+$/, "") +
      ".png"
    );
  }

  // Preload all images on page load
  function preloadImages() {
    tracks.forEach((track) => {
      const src = getImagePath(track);
      const img = new Image();
      img.src = src;
      imageCache[track] = img; // save Image object for later use
    });
  }

  let isRolling = false;
  let rollingInterval = null;

function pickRandomTrack() {
  const resultEl = document.getElementById("track-result");
  const imageEl = document.getElementById("track-image");
  const selectbtn = document.getElementById("rolling-btn");

  if (isRolling) {
    clearInterval(rollingInterval);
    isRolling = false;
    selectbtn.innerText = "RE-ROLL";
    const finalIndex = Math.floor(Math.random() * tracks.length);
    const finalTrack = tracks[finalIndex];
    resultEl.innerText = finalTrack;
    imageEl.src = imageCache[finalTrack].src;
    imageEl.style.display = "block";
    resultEl.classList.remove("rolling");

    imageEl.classList.remove("shake");  // STOP shake on final

    // ðŸŽ‰ Confetti celebration
    confetti({
      particleCount: 150,
      spread: 70,
      origin: { y: 0.6 },
      gravity: 0.8,
      ticks: 200,
      scalar: 1.2
    });

    return;
  }

  isRolling = true;
  resultEl.classList.add("rolling");
  selectbtn.innerText = "ROLLING";

  imageEl.style.display = "block";
  imageEl.classList.add("shake");  // START shake during rolling

  let rollCount = 0;
  const rollDuration = 3000;
  const rollSpeed = 75;

  rollingInterval = setInterval(() => {
    const randomIndex = Math.floor(Math.random() * tracks.length);
    const currentTrack = tracks[randomIndex];
    resultEl.innerText = currentTrack;
    imageEl.src = imageCache[currentTrack].src;
    rollCount += rollSpeed;

    if (rollCount >= rollDuration) {
      clearInterval(rollingInterval);
      isRolling = false;
      selectbtn.innerText = "RE-ROLL";
      const finalIndex = Math.floor(Math.random() * tracks.length);
      const finalTrack = tracks[finalIndex];
      resultEl.innerText = finalTrack;
      imageEl.src = imageCache[finalTrack].src;
      resultEl.classList.remove("rolling");

      imageEl.classList.remove("shake");  // STOP shake when final

      // ðŸŽ‰ Confetti celebration
      confetti({
        particleCount: 150,
        spread: 70,
        origin: { y: 0.6 },
        gravity: 0.8,
        ticks: 200,
        scalar: 1.2
      });
    }
  }, rollSpeed);
}

  // Preload images when DOM content is loaded
  document.addEventListener("DOMContentLoaded", preloadImages);
</script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
