<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Characters</title>
  <link rel="icon" href="img/favicon.png" type="image/png">
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body class="body-bg">

<nav class="navbar sticky-top navbar-expand-lg glassy-squared">
  <div class="container-fluid">
    <a class="navbar-brand mkfont text-white padding-L title main-heading">Character</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item bold"><a class="nav-link active" href="index.html">Home</a></li>
        <li class="nav-item dropdown bold">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Categories</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="gp.html">Grand Prix</a></li>
            <li><a class="dropdown-item" href="ko.html">Knockout</a></li>
            <li><a class="dropdown-item" href="vs.html">VS</a></li>
            <li><a class="dropdown-item" href="characters.html">Characters</a></li>
            <li><a class="dropdown-item" href="kart.html">Kart</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="body-bg super-padding">
  <div>
    <h1 class="mkfont padding-top centre main-heading">CHARACTER<br>RANDOMISER</h1>
  </div>
  <div class="super-padding"><br><br><br></div>

  <div class="text-center my-4">
    <button class="mkfont btn-lg glassy large-btn text-white btntext glow-button" id="rolling-btn" onclick="pickRandomTrack()">ROLL</button>
    <h2 id="track-result" class="mt-3 title"></h2>
    <img id="track-image" src="" alt="" style="max-width: 300px; margin-top: 1rem; display: none;" class="img-fluid mx-auto d-block">
  </div>
</div>

<footer class="footer super-margin text-center text-white py-4">
  <div class="container">
    <p class="mb-1">MarioKart World Track Chooser</p>
    <small>Not affiliated with Nintendo. This is just a little service to those wanting to spice up their MarioKart World gameplay. Feel free to add me on Discord @dr3kiki or Instagram by the same name. ENJOY!</small>
  </div>
</footer>

  <script>
    const tracks = [
      "Mario",
      "Luigi",
      "Peach",
      "Yoshi",
      "Bowser",
      "Toad",
      "Toadette",
      "Koopa Troopa",
      "Wario",
      "Waluigi",
      "Baby Mario",
      "Baby Luigi",
      "Baby Peach",
      "Baby Daisy",
      "Baby Rosalina",
      "Pauline",
      "Shy Guy",
      "Donkey Kong",
      "Daisy",
      "Rosalina",
      "Lakitu",
      "Birdo",
      "King Boo",
      "Bowser Jr.",
      "Goomba",
      "Wiggler",
      "Dry Bones",
      "Hammer Bro",
      "Nabbit",
      "Piranha Plant",
      "Sidestepper",
      "Monty Mole",
      "Stingby",
      "Penguin",
      "Cheep Cheep",
      "Cow",
      "Para-Biddybud",
      "Pokey",
      "Snowman",
      "Spike",
      "Cataquack",
      "Pianta",
      "Rocky Wrench",
      "Conkdor",
      "Peepa",
      "Swoop",
      "Fish Bone",
      "Coin Coffer",
      "Dolphin",
      "Chargin' Chuck",
    ];

    function getImagePath(name) {
      return (
        "img/characters/" +
        name
          .toLowerCase()
          .replace(/[^a-z0-9]+/g, "-")
          .replace(/-+$/, "") +
        ".png"
      );
    }

    let isRolling = false;
    let rollingInterval = null;

    // Preload all images, then enable roll button
    function preloadImages(imageUrls) {
      return Promise.all(
        imageUrls.map(
          (url) =>
            new Promise((resolve) => {
              const img = new Image();
              img.src = url;
              img.onload = resolve;
              img.onerror = resolve; // resolve on error so it doesn't block
            })
        )
      );
    }

    // Get all image URLs from tracks
    const imageUrls = tracks.map(getImagePath);

    const rollBtn = document.getElementById("rolling-btn");
    const resultEl = document.getElementById("track-result");
    const imageEl = document.getElementById("track-image");

    // Disable roll button until images are preloaded
    rollBtn.disabled = true;
    rollBtn.innerText = "LOADING...";

    preloadImages(imageUrls).then(() => {
      rollBtn.disabled = false;
      rollBtn.innerText = "ROLL";
    });

    function pickRandomTrack() {
      if (isRolling) {
        clearInterval(rollingInterval);
        isRolling = false;
        rollBtn.innerText = "RE-ROLL";
        const finalIndex = Math.floor(Math.random() * tracks.length);
        const finalTrack = tracks[finalIndex];
        resultEl.innerText = finalTrack;
        resultEl.classList.remove("rolling");
        imageEl.src = getImagePath(finalTrack);
        imageEl.style.display = "block";
        imageEl.classList.remove("shake");

        // ðŸŽ‰ Confetti effect
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });

        return;
      }

      isRolling = true;
      resultEl.classList.add("rolling");
      rollBtn.innerText = "ROLLING";
      imageEl.style.display = "block";
      imageEl.classList.add("shake");

      let rollCount = 0;
      const rollDuration = 3000;
      const rollSpeed = 75;

      rollingInterval = setInterval(() => {
        const randomIndex = Math.floor(Math.random() * tracks.length);
        const currentTrack = tracks[randomIndex];
        resultEl.innerText = currentTrack;
        imageEl.src = getImagePath(currentTrack);
        rollCount += rollSpeed;

        if (rollCount >= rollDuration) {
          clearInterval(rollingInterval);
          isRolling = false;
          rollBtn.innerText = "RE-ROLL";
          const finalIndex = Math.floor(Math.random() * tracks.length);
          const finalTrack = tracks[finalIndex];
          resultEl.innerText = finalTrack;
          imageEl.src = getImagePath(finalTrack);
          resultEl.classList.remove("rolling");
          imageEl.classList.remove("shake");

          // ðŸŽ‰ Confetti effect
          confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        }
      }, rollSpeed);
    }
  </script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
